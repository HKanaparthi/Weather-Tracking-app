<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard - GoWeather Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/dashboard.css">
</head>
<body>
<!-- Header -->
<div class="header">
    <a href="/" class="logo">
        <i class="fas fa-cloud-sun"></i>
        <span>GoWeather Premium</span>
    </a>
    <div class="auth-buttons">
        <span class="welcome-text">Welcome, {{.User.Username}}</span>
        <a href="/profile" class="profile-button">
            <div class="profile-circle">
                {{ if .User.Username }}
                <span>{{ slice .User.Username 0 1 | toUpper }}</span>
                {{ else }}
                <span>U</span>
                {{ end }}
            </div>
        </a>
        <a href="/compare" class="auth-button">Compare</a>
        <a href="/historical-comparison" class="auth-button">Historical</a>
        <a href="/activities" class="auth-button">Activities</a>
        <a href="/alerts" class="auth-button premium-feature">Alerts</a>
        <a href="/logout" class="auth-button">Logout</a>
    </div>
</div>

<!-- Main Dashboard -->
<div class="dashboard-container">
    <!-- Search Bar -->
    <div class="search-container">
        <form id="searchForm" action="/weather" method="GET">
            <input type="text" name="city" id="cityInput" class="search-bar" placeholder="Enter your place" value="{{.City}}">
            <button type="button" id="getLocation" class="location-button" title="Use your current location">
                <i class="fas fa-location-arrow"></i>
            </button>
            <select name="forecast_days" id="forecastDays" class="forecast-select premium-feature">
                <option value="7">7-Day Forecast</option>
                <option value="14">14-Day Forecast</option>
                <option value="16">16-Day Forecast</option>
            </select>
            <button type="submit" class="search-button">Get Weather</button>
        </form>
    </div>

    <!-- Premium Badge -->
    <div class="premium-badge">
        <i class="fas fa-crown"></i> Premium Data
    </div>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="loading">
        <div class="spinner"></div>
        <span>Getting premium weather data for your location...</span>
    </div>

    <!-- Weather Dashboard -->
    <div class="weather-dashboard">
        <!-- Temperature Card -->
        <div class="weather-card temperature-card">
            <div class="card-label">temperature</div>
            <div class="temperature">
                <span id="currentTemp">{{if .Weather}}{{.Weather.CurrentTemp}}{{else}}23{{end}}</span>
                <span class="degree">°C</span>
            </div>
            <div class="weather-desc" id="weatherType">{{if .Weather}}{{.Weather.Condition}}{{else}}Clear{{end}}</div>
            <div class="weather-sublabel">weather</div>
            <div class="feels-like premium-feature">
                Feels like: <span id="feelsLike">{{if .Weather}}{{.Weather.FeelsLike}}{{else}}25{{end}}</span>°C
            </div>
        </div>

        <!-- Location Card -->
        <div class="weather-card location-card">
            <div class="location-info">
                <i class="fas fa-map-marker-alt"></i>
                <span id="locationName">{{if .Weather}}{{.City}}{{else}}Country, City{{end}}</span>
            </div>
            <div class="location-details premium-feature">
                <div><i class="fas fa-globe"></i> <span id="countryCode">{{if .Weather}}{{.Weather.CountryCode}}{{else}}US{{end}}</span></div>
                <div><i class="fas fa-map-pin"></i> <span id="coordinates">{{if .Weather}}{{.Weather.Lat}}, {{.Weather.Lon}}{{else}}0.00, 0.00{{end}}</span></div>
                <div><i class="fas fa-clock"></i> <span id="timezone">{{if .Weather}}{{.Weather.Timezone}}{{else}}UTC+0{{end}}</span></div>
            </div>
        </div>

        <!-- Current Weather Card -->
        <div class="weather-card current-card">
            <div class="card-header">
                <span id="currentDegree">{{if .Weather}}{{.Weather.CurrentTemp}}{{else}}23{{end}}</span>°
            </div>
            <div class="card-content">
                <i class="fas fa-sun"></i>
                <div class="weather-label" id="currentWeatherLabel">{{if .Weather}}{{.Weather.Condition}}{{else}}Sunny{{end}}</div>
                <div class="weather-sublabel">Weather</div>
            </div>
        </div>

        <!-- Cloudy Weather Card -->
        <div class="weather-card cloudy-card">
            <div class="card-header">
                <span id="cloudyDegree">{{if .Weather}}{{.Weather.CurrentTemp}}{{else}}23{{end}}</span>°
            </div>
            <div class="card-content">
                <i class="fas fa-cloud"></i>
                <div class="weather-label">Mainly cloudy</div>
                <div class="weather-sublabel">Weather</div>
            </div>
        </div>

        <!-- Humidity Card -->
        <div class="weather-card humidity-card">
            <div class="card-label">Humidity</div>
            <div class="percentage">
                <span id="humidityValue">{{if .Weather}}{{.Weather.Humidity}}{{else}}63{{end}}</span>%
            </div>
            <div class="indicator">
                <div class="indicator-bar">
                    <div class="indicator-fill" style="width: {{if .Weather}}{{.Weather.Humidity}}{{else}}63{{end}}%;"></div>
                </div>
            </div>
            <div class="indicator-labels">
                <span>Overcast</span>
                <span>Precipitation</span>
            </div>
            <div class="date-info" id="currentDate"></div>
        </div>

        <!-- Air Quality Card (Premium Feature) -->
        <div class="weather-card air-quality-card premium-feature">
            <div class="card-label">Air Quality Index</div>
            <div class="aqi-value" id="aqiValue">{{if .Weather}}{{.Weather.AQI}}{{else}}35{{end}}</div>
            <div class="aqi-status" id="aqiStatus">{{if .Weather}}{{.Weather.AQIStatus}}{{else}}Good{{end}}</div>
            <div class="aqi-components">
                <div class="aqi-component">
                    <div class="component-name">PM2.5</div>
                    <div class="component-value" id="pm25">{{if .Weather}}{{.Weather.PM25}}{{else}}12.5{{end}}</div>
                </div>
                <div class="aqi-component">
                    <div class="component-name">PM10</div>
                    <div class="component-value" id="pm10">{{if .Weather}}{{.Weather.PM10}}{{else}}25.3{{end}}</div>
                </div>
            </div>
        </div>

        <!-- UV Index Card (Premium Feature) -->
        <div class="weather-card uv-card premium-feature">
            <div class="card-label">UV Index</div>
            <div class="uv-value" id="uvValue">{{if .Weather}}{{.Weather.UVIndex}}{{else}}5.2{{end}}</div>
            <div class="uv-status" id="uvStatus">{{if .Weather}}{{.Weather.UVStatus}}{{else}}Moderate{{end}}</div>
            <div class="uv-message" id="uvMessage">{{if .Weather}}{{.Weather.UVMessage}}{{else}}Some protection required{{end}}</div>
        </div>

        <!-- Hourly Forecast -->
        <div class="weather-card hourly-card">
            <div class="hourly-times">
                <div class="time-slot active">
                    <div class="time-label">Now</div>
                    <div class="time-temp">{{if .Weather}}{{.Weather.CurrentTemp}}{{else}}23{{end}}°</div>
                    <div class="time-icon"><i class="fas fa-cloud"></i></div>
                    <div class="precipitation premium-feature">{{if .Weather}}{{.Weather.CurrentPrecipProb}}{{else}}5{{end}}%</div>
                </div>
                {{if .Weather}}
                {{range $i, $hour := .HourlyForecast}}
                <div class="time-slot">
                    <div class="time-label">{{$hour.Time}}</div>
                    <div class="time-temp">{{$hour.Temp}}°</div>
                    <div class="time-icon"><i class="{{$hour.Icon}}"></i></div>
                    <div class="precipitation premium-feature">{{$hour.PrecipProb}}%</div>
                </div>
                {{end}}
                {{else}}
                <div class="time-slot">
                    <div class="time-label">1pm</div>
                    <div class="time-temp">23°</div>
                    <div class="time-icon"><i class="fas fa-sun"></i></div>
                    <div class="precipitation premium-feature">0%</div>
                </div>
                <div class="time-slot">
                    <div class="time-label">2pm</div>
                    <div class="time-temp">23°</div>
                    <div class="time-icon"><i class="fas fa-sun"></i></div>
                    <div class="precipitation premium-feature">0%</div>
                </div>
                <div class="time-slot">
                    <div class="time-label">3pm</div>
                    <div class="time-temp">23°</div>
                    <div class="time-icon"><i class="fas fa-sun"></i></div>
                    <div class="precipitation premium-feature">5%</div>
                </div>
                <div class="time-slot">
                    <div class="time-label">4pm</div>
                    <div class="time-temp">23°</div>
                    <div class="time-icon"><i class="fas fa-cloud-sun"></i></div>
                    <div class="precipitation premium-feature">10%</div>
                </div>
                <div class="time-slot">
                    <div class="time-label">5pm</div>
                    <div class="time-temp">23°</div>
                    <div class="time-icon"><i class="fas fa-cloud-rain"></i></div>
                    <div class="precipitation premium-feature">40%</div>
                </div>
                <div class="time-slot">
                    <div class="time-label">6pm</div>
                    <div class="time-temp">23°</div>
                    <div class="time-icon"><i class="fas fa-cloud"></i></div>
                    <div class="precipitation premium-feature">25%</div>
                </div>
                {{end}}
            </div>
        </div>

        <!-- Daily Forecast -->
        <div class="weather-card daily-card">
            <div class="daily-forecast-heading">
                <span id="forecastDaysDisplay">16</span>-Day Forecast
                <span class="premium-badge-small premium-feature"><i class="fas fa-crown"></i></span>
            </div>
            <div class="daily-forecast">
                {{if .Weather}}
                {{range $i, $day := .Forecast}}
                <div class="day-row {{if eq $i 0}}active{{end}}">
                    <div class="day-name">{{$day.Day}}</div>
                    <div class="day-icon"><i class="{{$day.Icon}}"></i></div>
                    <div class="day-temp">{{$day.MaxTemp}}° <span class="low-temp">{{$day.MinTemp}}°</span></div>
                    <div class="day-details premium-feature">
                        <div class="precipitation-chance"><i class="fas fa-tint"></i> {{$day.PrecipProb}}%</div>
                        <div class="wind-speed"><i class="fas fa-wind"></i> {{$day.WindSpeed}} km/h</div>
                    </div>
                </div>
                {{end}}
                {{else}}
                <div class="day-row">
                    <div class="day-name">Su</div>
                    <div class="day-icon"><i class="fas fa-cloud-sun"></i></div>
                    <div class="day-temp">23° <span class="low-temp">13°</span></div>
                    <div class="day-details premium-feature">
                        <div class="precipitation-chance"><i class="fas fa-tint"></i> 20%</div>
                        <div class="wind-speed"><i class="fas fa-wind"></i> 12 km/h</div>
                    </div>
                </div>
                <div class="day-row">
                    <div class="day-name">Mo</div>
                    <div class="day-icon"><i class="fas fa-sun"></i></div>
                    <div class="day-temp">24° <span class="low-temp">17°</span></div>
                    <div class="day-details premium-feature">
                        <div class="precipitation-chance"><i class="fas fa-tint"></i> 10%</div>
                        <div class="wind-speed"><i class="fas fa-wind"></i> 8 km/h</div>
                    </div>
                </div>
                <div class="day-row active">
                    <div class="day-name">Tu</div>
                    <div class="day-icon"><i class="fas fa-sun"></i></div>
                    <div class="day-temp">22° <span class="low-temp">14°</span></div>
                    <div class="day-details premium-feature">
                        <div class="precipitation-chance"><i class="fas fa-tint"></i> 5%</div>
                        <div class="wind-speed"><i class="fas fa-wind"></i> 10 km/h</div>
                    </div>
                </div>
                <div class="day-row">
                    <div class="day-name">We</div>
                    <div class="day-icon"><i class="fas fa-cloud"></i></div>
                    <div class="day-temp">20° <span class="low-temp">12°</span></div>
                    <div class="day-details premium-feature">
                        <div class="precipitation-chance"><i class="fas fa-tint"></i> 30%</div>
                        <div class="wind-speed"><i class="fas fa-wind"></i> 15 km/h</div>
                    </div>
                </div>
                <div class="day-row">
                    <div class="day-name">Th</div>
                    <div class="day-icon"><i class="fas fa-cloud-rain"></i></div>
                    <div class="day-temp">21° <span class="low-temp">12°</span></div>
                    <div class="day-details premium-feature">
                        <div class="precipitation-chance"><i class="fas fa-tint"></i> 70%</div>
                        <div class="wind-speed"><i class="fas fa-wind"></i> 20 km/h</div>
                    </div>
                </div>
                <div class="day-row">
                    <div class="day-name">Fr</div>
                    <div class="day-icon"><i class="fas fa-sun"></i></div>
                    <div class="day-temp">19° <span class="low-temp">13°</span></div>
                    <div class="day-details premium-feature">
                        <div class="precipitation-chance"><i class="fas fa-tint"></i> 5%</div>
                        <div class="wind-speed"><i class="fas fa-wind"></i> 12 km/h</div>
                    </div>
                </div>
                <div class="day-row">
                    <div class="day-name">Sa</div>
                    <div class="day-icon"><i class="fas fa-bolt"></i></div>
                    <div class="day-temp">18° <span class="low-temp">12°</span></div>
                    <div class="day-details premium-feature">
                        <div class="precipitation-chance"><i class="fas fa-tint"></i> 40%</div>
                        <div class="wind-speed"><i class="fas fa-wind"></i> 22 km/h</div>
                    </div>
                </div>
                {{end}}
            </div>
        </div>

        <!-- Weather Information Cards -->
        <div class="info-row">
            <div class="weather-card info-card">
                <div class="info-header">Weather</div>
                <div class="info-icon"><i class="fas fa-angle-right"></i></div>
            </div>
            <div class="weather-card info-card">
                <div class="info-header">News</div>
                <div class="info-icon"><i class="fas fa-angle-right"></i></div>
            </div>
            <div class="weather-card info-card">
                <div class="info-header">Informers</div>
                <div class="info-icon"><i class="fas fa-angle-right"></i></div>
            </div>
        </div>

        <!-- Wind Information -->
        <div class="weather-card wind-card premium-feature-card">
            <div class="card-label">Wind</div>
            <div class="wind-speed-value">
                <span id="windSpeed">{{if .Weather}}{{.Weather.WindSpeed}}{{else}}12{{end}}</span> km/h
            </div>
            <div class="wind-direction">
                <i class="fas fa-location-arrow" id="windDirectionIcon" style="transform: rotate({{if .Weather}}{{.Weather.WindDeg}}{{else}}45{{end}}deg)"></i>
                <span id="windDirection">{{if .Weather}}{{.Weather.WindDirection}}{{else}}NE{{end}}</span>
            </div>
            <div class="wind-gust premium-feature">
                Gusts: <span id="windGust">{{if .Weather}}{{.Weather.WindGust}}{{else}}18{{end}}</span> km/h
            </div>
        </div>

        <!-- Rain Information -->
        <div class="weather-card rain-card premium-feature-card">
            <div class="card-label">Precipitation</div>
            <div class="rain-amount">
                <span id="precipAmount">{{if .Weather}}{{.Weather.PrecipAmount}}{{else}}2.5{{end}}</span> mm
            </div>
            <div class="rain-probability">
                Probability: <span id="precipProb">{{if .Weather}}{{.Weather.PrecipProb}}{{else}}40{{end}}</span>%
            </div>
            <div class="rain-types premium-feature">
                <div>Rain: <span id="rainAmount">{{if .Weather}}{{.Weather.RainAmount}}{{else}}2.2{{end}}</span> mm</div>
                <div>Snow: <span id="snowAmount">{{if .Weather}}{{.Weather.SnowAmount}}{{else}}0.3{{end}}</span> mm</div>
            </div>
        </div>

        <!-- Sunrise/Sunset Card (Premium Feature) -->
        <div class="weather-card sun-card premium-feature-card">
            <div class="card-label">Sun & Moon</div>
            <div class="sun-times">
                <div class="sunrise">
                    <i class="fas fa-sun"></i> Rise: <span id="sunriseTime">{{if .Weather}}{{.Weather.Sunrise}}{{else}}06:45{{end}}</span>
                </div>
                <div class="sunset">
                    <i class="fas fa-moon"></i> Set: <span id="sunsetTime">{{if .Weather}}{{.Weather.Sunset}}{{else}}19:30{{end}}</span>
                </div>
            </div>
            <div class="day-length">
                Day Length: <span id="dayLength">{{if .Weather}}{{.Weather.DayLength}}{{else}}12h 45m{{end}}</span>
            </div>
            <div class="moon-phase">
                Moon Phase: <span id="moonPhase">{{if .Weather}}{{.Weather.MoonPhase}}{{else}}Waxing Gibbous{{end}}</span>
            </div>
        </div>

        <!-- Statistics Card -->
        <div class="weather-card stats-card">
            <div class="stats-graph">
                <!-- Placeholder for graph -->
                <svg width="100%" height="100%" viewBox="0 0 300 100">
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#8a3de5;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#f075e6;stop-opacity:0.3" />
                        </linearGradient>
                    </defs>
                    <path d="M0,50 Q50,20 100,40 T200,60 T300,30" stroke="#f075e6" fill="none" stroke-width="2"/>
                    <path d="M0,50 Q50,20 100,40 T200,60 T300,30 V100 H0 Z" fill="url(#gradient)" opacity="0.5"/>

                    <!-- Points on the graph -->
                    <circle cx="100" cy="40" r="4" fill="#f075e6" />
                    <circle cx="200" cy="60" r="4" fill="#f075e6" />
                    <circle cx="200" cy="60" r="8" fill="#f075e6" fill-opacity="0.3" />
                </svg>
            </div>
            <div class="weekdays">
                <span>S</span>
                <span>M</span>
                <span>T</span>
                <span>W</span>
                <span>T</span>
                <span>F</span>
                <span>S</span>
            </div>
        </div>
    </div>

    <!-- Weather Alerts Section (Premium Feature) -->
    <div class="weather-alerts-section premium-feature-section">
        <h3>Weather Alerts <span class="premium-badge-small"><i class="fas fa-crown"></i></span></h3>
        <div class="alerts-container" id="alertsContainer">
            {{if .Alerts}}
            {{range $alert := .Alerts}}
            <div class="alert-item {{$alert.Severity}}">
                <div class="alert-header">
                    <span class="alert-title">{{$alert.Title}}</span>
                    <span class="alert-time">{{$alert.Time}}</span>
                </div>
                <div class="alert-description">{{$alert.Description}}</div>
            </div>
            {{end}}
            {{else}}
            <div class="alert-item info">
                <div class="alert-header">
                    <span class="alert-title">No current alerts for this location</span>
                    <span class="alert-time">Now</span>
                </div>
                <div class="alert-description">Weather conditions appear normal. We'll notify you if any alerts are issued.</div>
            </div>
            {{end}}
        </div>
    </div>
</div>

<script src="/static/js/dashboard.js"></script>
<script>
    // API Key - Update with premium key
    const API_KEY = "0c2e2084bdd01a671b1b450215191f89";

    document.addEventListener('DOMContentLoaded', function() {
        // Update current date
        const updateDate = () => {
            const now = new Date();
            const formattedDate = `${now.getDate().toString().padStart(2, '0')}.${(now.getMonth() + 1).toString().padStart(2, '0')}.${now.getFullYear()}`;
            document.getElementById('currentDate').textContent = formattedDate;
        };
        updateDate();

        // Set humidity indicator
        const humidityValue = parseInt(document.getElementById('humidityValue').textContent);
        const indicatorFill = document.querySelector('.indicator-fill');
        if (indicatorFill && !indicatorFill.style.width) {
            indicatorFill.style.width = `${humidityValue}%`;
        }

        // Interactive elements
        const timeSlots = document.querySelectorAll('.time-slot');
        timeSlots.forEach(slot => {
            slot.addEventListener('click', function() {
                timeSlots.forEach(s => s.classList.remove('active'));
                this.classList.add('active');
            });
        });

        const dayRows = document.querySelectorAll('.day-row');
        dayRows.forEach(row => {
            row.addEventListener('click', function() {
                dayRows.forEach(r => r.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Forecast days selector - Premium feature
        const forecastDaysSelect = document.getElementById('forecastDays');
        if (forecastDaysSelect) {
            forecastDaysSelect.addEventListener('change', function() {
                document.getElementById('forecastDaysDisplay').textContent = this.value;
            });
        }

        // Location button functionality
        const getLocationBtn = document.getElementById('getLocation');
        const loadingIndicator = document.getElementById('loadingIndicator');

        if (getLocationBtn) {
            getLocationBtn.addEventListener('click', function() {
                if (navigator.geolocation) {
                    loadingIndicator.style.display = 'flex';

                    navigator.geolocation.getCurrentPosition(
                        function(position) {
                            // With premium API, we can use reverse geocoding
                            const lat = position.coords.latitude;
                            const lon = position.coords.longitude;

                            // Redirect to weather with coordinates
                            window.location.href = `/weather?lat=${lat}&lon=${lon}`;
                        },
                        function(error) {
                            loadingIndicator.style.display = 'none';
                            alert('Unable to retrieve your location. Please enter a city name.');
                        }
                    );
                } else {
                    alert('Geolocation is not supported by your browser. Please enter a city name.');
                }
            });
        }

        // Premium feature animations
        const premiumFeatures = document.querySelectorAll('.premium-feature, .premium-feature-card, .premium-feature-section');
        premiumFeatures.forEach(feature => {
            feature.classList.add('premium-highlight');
            setTimeout(() => {
                feature.classList.remove('premium-highlight');
            }, 2000);
        });
    });
</script>

<!-- Premium features CSS -->
<style>
    .premium-feature, .premium-feature-card, .premium-feature-section {
        position: relative;
    }

    .premium-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
        color: #fff;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
        z-index: 10;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .premium-badge-small {
        background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
        color: #fff;
        padding: 2px 5px;
        border-radius: 8px;
        font-size: 10px;
        margin-left: 5px;
        display: inline-block;
    }

    .premium-highlight {
        animation: highlight-premium 2s ease-in-out;
    }

    @keyframes highlight-premium {
        0% { box-shadow: 0 0 0 rgba(246, 211, 101, 0); }
        50% { box-shadow: 0 0 10px rgba(246, 211, 101, 0.8); }
        100% { box-shadow: 0 0 0 rgba(246, 211, 101, 0); }
    }

    .forecast-select {
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #ddd;
        margin-right: 10px;
    }

    .weather-alerts-section {
        margin: 20px 0;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 15px;
        backdrop-filter: blur(10px);
    }

    .weather-alerts-section h3 {
        color: white;
        margin-top: 0;
        margin-bottom: 15px;
    }

    .alerts-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .alert-item {
        padding: 10px 15px;
        border-radius: 8px;
        border-left: 4px solid;
    }

    .alert-item.severe {
        border-left-color: #ff5252;
        background: rgba(255, 82, 82, 0.1);
    }

    .alert-item.moderate {
        border-left-color: #ffc107;
        background: rgba(255, 193, 7, 0.1);
    }

    .alert-item.minor {
        border-left-color: #4caf50;
        background: rgba(76, 175, 80, 0.1);
    }

    .alert-item.info {
        border-left-color: #2196f3;
        background: rgba(33, 150, 243, 0.1);
    }

    .alert-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 5px;
    }

    .alert-title {
        font-weight: bold;
        color: white;
    }

    .alert-time {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.7);
    }

    .alert-description {
        color: rgba(255, 255, 255, 0.9);
        font-size: 14px;
    }

    .air-quality-card, .uv-card {
        text-align: center;
    }

    .aqi-value, .uv-value {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 10px 0;
    }

    .aqi-status, .uv-status {
        font-size: 1.2rem;
        margin-bottom: 5px;
    }

    .aqi-components {
        display: flex;
        justify-content: space-around;
        margin-top: 10px;
    }

    .aqi-component {
        text-align: center;
    }

    .component-name {
        font-size: 0.8rem;
        opacity: 0.7;
    }

    .component-value {
        font-size: 1rem;
        font-weight: bold;
    }

    .uv-message {
        font-size: 0.9rem;
        opacity: 0.8;
        margin-top: 5px;
    }

    .sun-card {
        padding: 15px;
    }

    .sun-times {
        display: flex;
        justify-content: space-between;
        margin: 10px 0;
    }

    .day-length, .moon-phase {
        margin-top: 8px;
        font-size: 0.9rem;
    }

    .wind-card, .rain-card {
        padding: 15px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .wind-speed-value, .rain-amount {
        font-size: 1.8rem;
        font-weight: bold;
        margin: 5px 0;
    }

    .wind-direction, .rain-probability {
        margin: 5px 0;
    }

    .wind-gust, .rain-types {
        margin-top: 10px;
        font-size: 0.9rem;
    }

    .precipitation {
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.8);
        margin-top: 3px;
    }

    .feels-like {
        margin-top: 5px;
        font-size: 0.9rem;
    }

    .location-details {
        margin-top: 15px;
        font-size: 0.9rem;
    }

    .location-details div {
        margin: 5px 0;
    }

    .day-details {
        display: flex;
        justify-content: space-between;
        margin-top: 5px;
        font-size: 0.8rem;
    }
</style>

<!-- Add this section at the end to include the necessary JavaScript for premium features -->
<script>
    // Additional JavaScript for OpenWeather Premium API features

    // Function to fetch air quality data
    async function fetchAirQuality(lat, lon) {
        try {
            const response = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${API_KEY}`);
            if (!response.ok) throw new Error('Failed to fetch air quality data');
            const data = await response.json();

            // Update the UI with air quality data
            updateAirQualityUI(data.list[0]);
        } catch (error) {
            console.error('Error fetching air quality data:', error);
        }
    }

    // Function to update air quality UI
    function updateAirQualityUI(aqData) {
        if (!aqData) return;

        const aqiElement = document.getElementById('aqiValue');
        const aqiStatusElement = document.getElementById('aqiStatus');
        const pm25Element = document.getElementById('pm25');
        const pm10Element = document.getElementById('pm10');

        if (aqiElement) aqiElement.textContent = aqData.main.aqi;

        // Set AQI status based on value
        const aqiStatus = getAQIStatus(aqData.main.aqi);
        if (aqiStatusElement) aqiStatusElement.textContent = aqiStatus;

        // Set component values
        if (pm25Element) pm25Element.textContent = aqData.components.pm2_5.toFixed(1);
        if (pm10Element) pm10Element.textContent = aqData.components.pm10.toFixed(1);
    }

    // Function to get AQI status text
    function getAQIStatus(aqi) {
        switch(aqi) {
            case 1: return 'Good';
            case 2: return 'Fair';
            case 3: return 'Moderate';
            case 4: return 'Poor';
            case 5: return 'Very Poor';
            default: return 'Unknown';
        }
    }

    // Function to fetch and display UV index
    async function fetchUVIndex(lat, lon) {
        try {
            // Using OneCall API which includes UV index
            const response = await fetch(`https://api.openweathermap.org/data/3.0/onecall?lat=${lat}&lon=${lon}&exclude=minutely&appid=${API_KEY}`);
            if (!response.ok) throw new Error('Failed to fetch UV data');
            const data = await response.json();

            // Update UV index in UI
            updateUVIndexUI(data.current.uvi);
        } catch (error) {
            console.error('Error fetching UV data:', error);
        }
    }

    // Function to update UV index UI
    function updateUVIndexUI(uvIndex) {
        const uvValueElement = document.getElementById('uvValue');
        const uvStatusElement = document.getElementById('uvStatus');
        const uvMessageElement = document.getElementById('uvMessage');

        if (uvValueElement) uvValueElement.textContent = uvIndex.toFixed(1);

        // Set UV status and message based on index value
        const { status, message } = getUVStatus(uvIndex);

        if (uvStatusElement) uvStatusElement.textContent = status;
        if (uvMessageElement) uvMessageElement.textContent = message;
    }

    // Function to get UV status and message
    function getUVStatus(uvi) {
        if (uvi < 3) {
            return {
                status: 'Low',
                message: 'No protection needed'
            };
        } else if (uvi < 6) {
            return {
                status: 'Moderate',
                message: 'Some protection required'
            };
        } else if (uvi < 8) {
            return {
                status: 'High',
                message: 'Protection essential'
            };
        } else if (uvi < 11) {
            return {
                status: 'Very High',
                message: 'Extra protection needed'
            };
        } else {
            return {
                status: 'Extreme',
                message: 'Avoid being outside'
            };
        }
    }

    // Function to fetch weather alerts
    async function fetchWeatherAlerts(lat, lon) {
        try {
            // Using OneCall API which includes alerts
            const response = await fetch(`https://api.openweathermap.org/data/3.0/onecall?lat=${lat}&lon=${lon}&exclude=minutely&appid=${API_KEY}`);
            if (!response.ok) throw new Error('Failed to fetch alerts');
            const data = await response.json();

            // Update weather alerts in UI
            updateAlertsUI(data.alerts || []);
        } catch (error) {
            console.error('Error fetching weather alerts:', error);
        }
    }

    // Function to update alerts UI
    function updateAlertsUI(alerts) {
        const alertsContainer = document.getElementById('alertsContainer');
        if (!alertsContainer) return;

        // Clear existing alerts
        alertsContainer.innerHTML = '';

        if (alerts.length === 0) {
            // No alerts
            alertsContainer.innerHTML = `
                <div class="alert-item info">
                    <div class="alert-header">
                        <span class="alert-title">No current alerts for this location</span>
                        <span class="alert-time">Now</span>
                    </div>
                    <div class="alert-description">Weather conditions appear normal. We'll notify you if any alerts are issued.</div>
                </div>
            `;
            return;
        }

        // Add each alert to the container
        alerts.forEach(alert => {
            const severity = getSeverityClass(alert.event);
            const startTime = new Date(alert.start * 1000).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

            const alertHTML = `
                <div class="alert-item ${severity}">
                    <div class="alert-header">
                        <span class="alert-title">${alert.event}</span>
                        <span class="alert-time">${startTime}</span>
                    </div>
                    <div class="alert-description">${alert.description}</div>
                </div>
            `;

            alertsContainer.innerHTML += alertHTML;
        });
    }

    // Function to determine alert severity class
    function getSeverityClass(eventType) {
        const severeEvents = ['Hurricane', 'Tornado', 'Tsunami', 'Extreme'];
        const moderateEvents = ['Thunderstorm', 'Flood', 'Wind', 'Heat', 'Cold'];

        const eventLower = eventType.toLowerCase();

        if (severeEvents.some(term => eventLower.includes(term.toLowerCase()))) {
            return 'severe';
        } else if (moderateEvents.some(term => eventLower.includes(term.toLowerCase()))) {
            return 'moderate';
        } else {
            return 'minor';
        }
    }

    // Function to fetch 16-day forecast (premium feature)
    async function fetchExtendedForecast(city) {
        try {
            const response = await fetch(`https://api.openweathermap.org/data/2.5/forecast/daily?q=${city}&cnt=16&units=metric&appid=${API_KEY}`);
            if (!response.ok) throw new Error('Failed to fetch extended forecast');
            const data = await response.json();

            // Update UI with extended forecast
            updateExtendedForecastUI(data.list);
        } catch (error) {
            console.error('Error fetching extended forecast:', error);
        }
    }

    // Function to update extended forecast UI
    function updateExtendedForecastUI(forecastData) {
        const forecastContainer = document.querySelector('.daily-forecast');
        if (!forecastContainer || !forecastData) return;

        // Clear existing forecast
        forecastContainer.innerHTML = '';

        // Add each day to the forecast
        forecastData.forEach((day, index) => {
            const date = new Date(day.dt * 1000);
            const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });

            const weatherIcon = getWeatherIcon(day.weather[0].id);
            const maxTemp = Math.round(day.temp.max);
            const minTemp = Math.round(day.temp.min);
            const precipProb = Math.round((day.pop || 0) * 100);
            const windSpeed = Math.round(day.speed);

            const dayHTML = `
                <div class="day-row ${index === 0 ? 'active' : ''}">
                    <div class="day-name">${dayName}</div>
                    <div class="day-icon"><i class="${weatherIcon}"></i></div>
                    <div class="day-temp">${maxTemp}° <span class="low-temp">${minTemp}°</span></div>
                    <div class="day-details premium-feature">
                        <div class="precipitation-chance"><i class="fas fa-tint"></i> ${precipProb}%</div>
                        <div class="wind-speed"><i class="fas fa-wind"></i> ${windSpeed} km/h</div>
                    </div>
                </div>
            `;

            forecastContainer.innerHTML += dayHTML;
        });

        // Reattach event listeners
        const dayRows = document.querySelectorAll('.day-row');
        dayRows.forEach(row => {
            row.addEventListener('click', function() {
                dayRows.forEach(r => r.classList.remove('active'));
                this.classList.add('active');
            });
        });
    }

    // Function to get weather icon class based on condition id
    function getWeatherIcon(conditionId) {
        if (conditionId >= 200 && conditionId < 300) {
            return 'fas fa-bolt'; // Thunderstorm
        } else if (conditionId >= 300 && conditionId < 500) {
            return 'fas fa-cloud-rain'; // Drizzle
        } else if (conditionId >= 500 && conditionId < 600) {
            return 'fas fa-cloud-showers-heavy'; // Rain
        } else if (conditionId >= 600 && conditionId < 700) {
            return 'fas fa-snowflake'; // Snow
        } else if (conditionId >= 700 && conditionId < 800) {
            return 'fas fa-smog'; // Atmosphere (fog, mist)
        } else if (conditionId === 800) {
            return 'fas fa-sun'; // Clear
        } else if (conditionId > 800) {
            return 'fas fa-cloud'; // Clouds
        }
        return 'fas fa-cloud';
    }

    // Initialize premium features if location coordinates are available
    function initPremiumFeatures() {
        // Check if we have coordinates from the URL or stored in elements
        const coordsElement = document.getElementById('coordinates');
        if (!coordsElement) return;

        const coordsText = coordsElement.textContent;
        if (!coordsText || coordsText === '0.00, 0.00') return;

        // Parse coordinates
        const [lat, lon] = coordsText.split(',').map(coord => parseFloat(coord.trim()));
        if (isNaN(lat) || isNaN(lon)) return;

        // Fetch premium data
        fetchAirQuality(lat, lon);
        fetchUVIndex(lat, lon);
        fetchWeatherAlerts(lat, lon);

        // Get city name for extended forecast
        const cityElement = document.getElementById('locationName');
        if (cityElement && cityElement.textContent) {
            fetchExtendedForecast(cityElement.textContent.trim());
        }
    }

    // Call this function when page loads
    window.addEventListener('load', function() {
        setTimeout(initPremiumFeatures, 1000); // Slight delay to ensure other elements are loaded
    });
</script>
</body>
</html>